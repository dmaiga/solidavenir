{% extends 'base.html' %}
{% load static humanize %}

{% block title %}Espace Association - Solidavenir{% endblock %}

{% block content %}
<div class="container py-5">
    
 
    <!-- En-tête -->
  <div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="h2 mb-0">
                <i class="fas fa-users text-primary me-2"></i>Espace Association
            </h1>
            <div class="btn-group">
                <a href="{% url 'modifier_profil_association' %}" class="btn btn-primary">
                    <i class="fas fa-edit me-1"></i>Modifier le profil
                </a>
                <a href="{% url 'creer_projet' %}" class="btn btn-success">
                    <i class="fas fa-plus me-1"></i>Nouveau projet
                </a>
            </div>
        </div>

        <!-- Badge de validation du profil -->
        <div class="mt-2 ms-1">
            <span class="badge bg-{% if association.valide %}success{% else %}warning{% endif %}">
                {% if association.valide %}Profil validé{% else %}Profil en cours de validation{% endif %}
            </span>
        </div>

        <!-- Message général -->
        {% if not association.valide %}
            <p class="text-warning mt-2">
                Votre profil ou votre projet est en cours de validation par notre équipe. Vous serez informé dès qu’il sera validé.
            </p>
        {% endif %}

        <p class="text-muted">Gérez votre profil association et vos projets</p>
    </div>
</div>


    <div class="row">
        <!-- Sidebar de navigation -->
        <div class="col-lg-3">
            <div class="card shadow-sm mb-4">
                <div class="card-body text-center">
                    {% if association.logo %}
                    <img src="{{ association.logo.url }}" 
                         alt="{{ association.nom }}"
                         class="rounded-circle mb-3 border border-4 border-primary"
                         style="width: 100px; height: 100px; object-fit: cover;">
                    {% else %}
                    <div class="bg-light rounded-circle d-flex align-items-center justify-content-center mb-3 mx-auto" style="width: 100px; height: 100px;">
                        <i class="fas fa-users fa-2x text-muted"></i>
                    </div>
                    {% endif %}
                    
                    <h5 class="text-primary">{{ association.nom }}</h5>
                    {% if association.slogan %}
                    <p class="text-muted small">{{ association.slogan }}</p>
                    {% endif %}
                    
                    <div class="d-grid gap-2">
                        <a href="{% url 'modifier_profil_association' %}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-edit me-1"></i> Compléter le profil
                        </a>
                    </div>
                </div>
                
                <div class="list-group list-group-flush">
                    <a href="#profil" class="list-group-item list-group-item-action active">
                        <i class="fas fa-user-circle me-2"></i>Mon profil
                    </a>
                    <a href="#projets" class="list-group-item list-group-item-action">
                        <i class="fas fa-lightbulb me-2"></i>Mes projets
                    </a>
                    <a href="#statistiques" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-bar me-2"></i>Statistiques
                    </a>
                </div>
            </div>
        </div>

        <!-- Contenu principal -->
        <div class="col-lg-9">
            <!-- Section Profil -->
            <div class="card shadow-sm mb-4" id="profil">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-user-circle text-primary me-2"></i>Informations du profil
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Informations générales</h6>
                            <p>
                                <strong>Nom:</strong> {{ association.nom }}<br>
                                <strong>Slogan:</strong> {{ association.slogan|default:"Non renseigné" }}<br>
                                <strong>Statut juridique:</strong> {{ association.get_statut_juridique_display }}<br>
                                <strong>Domaine principal:</strong> {{ association.get_domaine_principal_display }}<br>
                                <strong>Domaine secondaires:</strong> {{ association.domaines_secondaires }}<br>
                                <strong>Date création:</strong> {{ association.date_creation|date:"d/m/Y" }}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6>Contact</h6>
                            <p>
                                <strong>Email:</strong> {{ association.email_contact|default:"Non renseigné" }}<br>
                                <strong>Téléphone:</strong> {{ association.telephone|default:"Non renseigné" }}<br>
                                <strong>Ville:</strong> {{ association.ville|default:"Non renseignée" }}<br>
                                <strong>Pays:</strong> {{ association.pays|default:"Non renseigné" }}<br>
                                <strong>Site web:</strong> 
                                {% if association.site_web %}
                                    <a href="{{ association.site_web }}" target="_blank">{{ association.site_web }}</a>
                                {% else %}
                                    Non renseigné
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    {% if association.causes_defendues %}
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6>Causes défendues</h6>
                            <p class="text-muted">{{ association.causes_defendues }}</p>
                        </div>
                    </div>
                    {% endif %}

                    {% if association.projets_phares %}
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6>Projets phares</h6>
                            <p class="text-muted">{{ association.projets_phares }}</p>
                        </div>
                    </div>
                    {% endif %}

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h6>Réseaux sociaux</h6>
                            <p>
                                {% if association.facebook %}
                                <a href="{{ association.facebook }}" target="_blank" class="text-decoration-none me-3">
                                    <i class="fab fa-facebook text-primary"></i> Facebook
                                </a><br>
                                {% endif %}
                                {% if association.twitter %}
                                <a href="{{ association.twitter }}" target="_blank" class="text-decoration-none me-3">
                                    <i class="fab fa-twitter text-info"></i> Twitter
                                </a><br>
                                {% endif %}
                                {% if association.instagram %}
                                <a href="{{ association.instagram }}" target="_blank" class="text-decoration-none">
                                    <i class="fab fa-instagram text-danger"></i> Instagram
                                </a>
                                {% endif %}
                                {% if not association.facebook and not association.twitter and not association.instagram %}
                                <span class="text-muted">Aucun réseau social renseigné</span>
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6>Transparence</h6>
                            <p>
                                <strong>Finances:</strong> 
                                {% if association.transparent_finances %}
                                <span class="text-success">✓ Partagées</span>
                                {% else %}
                                <span class="text-muted">Non partagées</span>
                                {% endif %}<br>
                                <strong>Actions:</strong> 
                                {% if association.transparent_actions %}
                                <span class="text-success">✓ Partagées</span>
                                {% else %}
                                <span class="text-muted">Non partagées</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Projets -->
            <div class="card shadow-sm mb-4" id="projets">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb text-warning me-2"></i>Mes projets
                    </h5>
                </div>
                <div class="card-body">
                    {% if stats.projets_total > 0 %}
                    <div class="row text-center mb-4">
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.projets_total }}</h3>
                                <small class="text-muted">Projets total</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.projets_actifs }}</h3>
                                <small class="text-muted">Projets actifs</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.montant_total|intcomma }} FCFA</h3>
                                <small class="text-muted">Total collecté</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.contributeurs_total|default:0 }}</h3>
                                <small class="text-muted">Contributeurs</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <a href="{% url 'mes_projets' %}" class="btn btn-primary">
                            <i class="fas fa-list me-1"></i> Gérer mes projets
                        </a>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-lightbulb text-muted fa-3x"></i>
                        <h5 class="text-muted mt-3">Aucun projet créé</h5>
                        <p class="text-muted">Commencez par créer votre premier projet de financement.</p>
                        <a href="{% url 'creer_projet' %}" class="btn btn-success">
                            <i class="fas fa-plus me-1"></i> Créer un projet
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Section Actions rapides -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt text-success me-2"></i>Actions rapides
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'modifier_profil_association' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-image me-1"></i>Logo & Bannière
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'modifier_profil_association' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-share-alt me-1"></i>Réseaux sociaux
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'creer_projet' %}" class="btn btn-outline-success w-100">
                                <i class="fas fa-plus me-1"></i>Nouveau projet
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.list-group-item {
    transition: all 0.3s ease;
    border: none;
    border-radius: 8px;
    margin-bottom: 0.25rem;
}

.list-group-item:hover {
    background-color: #f8f9fa;
    transform: translateX(5px);
}

.list-group-item.active {
    background: linear-gradient(135deg, #2563eb, #6366f1);
    border: none;
}

.card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.card-header {
    border-radius: 12px 12px 0 0;
    border: none;
}
</style>

<script>
// Scroll doux vers les sections
document.addEventListener('DOMContentLoaded', function() {
    const links = document.querySelectorAll('.list-group-item');
    
    links.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
{% endblock %}