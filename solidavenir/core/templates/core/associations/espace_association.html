{% extends 'base.html' %}
{% load static humanize %}

{% block title %}Espace Association - Solidavenir{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- En-tête -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h2 mb-0">
                    <i class="bi bi-people-fill text-primary me-2"></i>Espace Association
                </h1>
                <div class="btn-group">
                    <a href="{% url 'modifier_profil_association' %}" class="btn btn-primary">
                        <i class="bi bi-pencil me-1"></i>Modifier le profil
                    </a>
                    <a href="{% url 'creer_projet' %}" class="btn btn-success">
                        <i class="bi bi-plus-circle me-1"></i>Nouveau projet
                    </a>
                </div>
            </div>
            <p class="text-muted">Gérez votre profil association et vos projets</p>
        </div>
    </div>

    <!-- Bannière de statut -->
    {% if not association.valide %}
    <div class="alert alert-warning mb-4">
        <div class="d-flex align-items-center">
            <i class="bi bi-exclamation-triangle-fill me-3 fs-4"></i>
            <div>
                <h5 class="alert-heading mb-1">Profil en attente de validation</h5>
                <p class="mb-0">Votre association n'est pas encore visible publiquement. Elle est en cours de validation par notre équipe.</p>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-success mb-4">
        <div class="d-flex align-items-center">
            <i class="bi bi-check-circle-fill me-3 fs-4"></i>
            <div>
                <h5 class="alert-heading mb-1">Profil validé</h5>
                <p class="mb-0">Votre association est visible publiquement. <a href="{% url 'detail_association' association.slug %}" class="alert-link">Voir le profil public</a></p>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row">
        <!-- Sidebar de navigation -->
        <div class="col-lg-3">
            <div class="card shadow-sm mb-4">
                <div class="card-body text-center">
                    <img src="{{ association.get_logo_url }}" 
                         alt="{{ association.nom }}"
                         class="rounded-circle mb-3 border border-4 border-primary"
                         style="width: 100px; height: 100px; object-fit: cover;">
                    
                    <h5 class="text-primary">{{ association.nom }}</h5>
                    <p class="text-muted small">{{ association.slogan|default:"Ajoutez un slogan" }}</p>
                    
                    <div class="progress mb-3" style="height: 8px;">
                        <div class="progress-bar bg-success" style="width: {{ association.get_completion_percentage }}%;"></div>
                    </div>
                    <small class="text-muted">Profil complété à {{ association.get_completion_percentage }}%</small>
                </div>
                
                <div class="list-group list-group-flush">
                    <a href="#profil" class="list-group-item list-group-item-action active">
                        <i class="bi bi-person-circle me-2"></i>Mon profil
                    </a>
                    <a href="#projets" class="list-group-item list-group-item-action">
                        <i class="bi bi-lightbulb me-2"></i>Mes projets
                    </a>
                    <a href="#statistiques" class="list-group-item list-group-item-action">
                        <i class="bi bi-graph-up me-2"></i>Statistiques
                    </a>
                    <a href="#documents" class="list-group-item list-group-item-action">
                        <i class="bi bi-file-earmark me-2"></i>Documents
                    </a>
                </div>
            </div>
        </div>

        <!-- Contenu principal -->
        <div class="col-lg-9">
            <!-- Section Profil -->
            <div class="card shadow-sm mb-4" id="profil">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="bi bi-person-circle text-primary me-2"></i>Informations du profil
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Informations générales</h6>
                            <p>
                                <strong>Nom:</strong> {{ association.nom }}<br>
                                <strong>Slogan:</strong> {{ association.slogan|default:"Non renseigné" }}<br>
                                <strong>Statut juridique:</strong> {{ association.get_statut_juridique_display }}<br>
                                <strong>Agrément:</strong> {{ association.numero_agrement|default:"Non renseigné" }}<br>
                                <strong>Date création:</strong> {{ association.date_creation|date:"d/m/Y" }}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6>Contact</h6>
                            <p>
                                <strong>Email:</strong> {{ association.email_contact }}<br>
                                <strong>Téléphone:</strong> {{ association.telephone|default:"Non renseigné" }}<br>
                                <strong>Ville:</strong> {{ association.ville }}<br>
                                <strong>Commune:</strong> {{ association.commune|default:"Non renseignée" }}<br>
                                <strong>Site web:</strong> 
                                {% if association.site_web %}
                                    <a href="{{ association.site_web }}" target="_blank">{{ association.site_web }}</a>
                                {% else %}
                                    Non renseigné
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h6>Informations juridiques</h6>
                            <p>
                                <strong>RCCM:</strong> {{ association.numero_rc|default:"Non renseigné" }}<br>
                                <strong>IFU:</strong> {{ association.numero_ifu|default:"Non renseigné" }}<br>
                                <strong>Date agrément:</strong> {{ association.date_agrement|date:"d/m/Y"|default:"Non renseignée" }}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6>Chiffres clés</h6>
                            <p>
                                <strong>Adhérents:</strong> {{ association.nombre_adherents }}<br>
                                <strong>Bénéficiaires:</strong> {{ association.nombre_beneficiaires }}<br>
                                <strong>Budget annuel:</strong> {{ association.budget_annuel|default:0|intcomma }} FCFA<br>
                                <strong>Frais de gestion:</strong> {{ association.pourcentage_frais_gestion }}%
                            </p>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <a href="{% url 'modifier_profil_association' %}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-pencil"></i> Compléter le profil
                        </a>
                    </div>
                </div>
            </div>

            <!-- Section Projets -->
            <div class="card shadow-sm mb-4" id="projets">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="bi bi-lightbulb text-warning me-2"></i>Mes projets
                    </h5>
                </div>
                <div class="card-body">
                    {% if stats.projets_total > 0 %}
                    <div class="row text-center mb-4">
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.projets_total }}</h3>
                                <small class="text-muted">Projets total</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.projets_actifs }}</h3>
                                <small class="text-muted">Projets actifs</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.montant_total|intcomma }} FCFA</h3>
                                <small class="text-muted">Total collecté</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.donateurs_total|default:0 }}</h3>
                                <small class="text-muted">Donateurs</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <a href="{% url 'mes_projets' %}" class="btn btn-primary">
                            <i class="bi bi-list-ul me-1"></i> Gérer mes projets
                        </a>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-lightbulb text-muted display-4"></i>
                        <h5 class="text-muted mt-3">Aucun projet créé</h5>
                        <p class="text-muted">Commencez par créer votre premier projet de financement.</p>
                        <a href="{% url 'creer_projet' %}" class="btn btn-success">
                            <i class="bi bi-plus-circle me-1"></i> Créer un projet
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Section Documents -->
            <div class="card shadow-sm mb-4" id="documents">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="bi bi-file-earmark text-primary me-2"></i>Documents administratifs
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h6>Documents requis</h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="bi bi-file-pdf text-danger me-2"></i>
                                    {% if association.agrement_file %}
                                        <a href="{{ association.agrement_file.url }}" target="_blank">Agrément</a>
                                        <span class="badge bg-success ms-2">Uploadé</span>
                                    {% else %}
                                        <span class="text-muted">Agrément manquant</span>
                                    {% endif %}
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-file-pdf text-danger me-2"></i>
                                    {% if association.statuts_file %}
                                        <a href="{{ association.statuts_file.url }}" target="_blank">Statuts</a>
                                        <span class="badge bg-success ms-2">Uploadé</span>
                                    {% else %}
                                        <span class="text-muted">Statuts manquants</span>
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6>Documents optionnels</h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="bi bi-file-pdf text-primary me-2"></i>
                                    {% if association.rapport_annuel %}
                                        <a href="{{ association.rapport_annuel.url }}" target="_blank">Rapport annuel</a>
                                    {% else %}
                                        <span class="text-muted">Rapport annuel</span>
                                    {% endif %}
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-file-pdf text-primary me-2"></i>
                                    {% if association.comptes_annuels %}
                                        <a href="{{ association.comptes_annuels.url }}" target="_blank">Comptes annuels</a>
                                    {% else %}
                                        <span class="text-muted">Comptes annuels</span>
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <a href="{% url 'modifier_profil_association' %}#documents" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-upload me-1"></i> Uploader des documents
                        </a>
                    </div>
                </div>
            </div>

            <!-- Section Transparence -->
            <div class="card shadow-sm mb-4" id="transparence">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="bi bi-shield-check text-success me-2"></i>Transparence
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-3">
                                {% if association.transparent_finances %}
                                    <i class="bi bi-check-circle-fill text-success me-2 fs-5"></i>
                                    <span>Transparence financière activée</span>
                                {% else %}
                                    <i class="bi bi-x-circle-fill text-danger me-2 fs-5"></i>
                                    <span>Transparence financière désactivée</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-3">
                                {% if association.transparent_actions %}
                                    <i class="bi bi-check-circle-fill text-success me-2 fs-5"></i>
                                    <span>Transparence des actions activée</span>
                                {% else %}
                                    <i class="bi bi-x-circle-fill text-danger me-2 fs-5"></i>
                                    <span>Transparence des actions désactivée</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        L'activation de la transparence augmente la confiance des donateurs et améliore la visibilité de votre association.
                    </div>
                </div>
            </div>

            <!-- Section Actions rapides -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="bi bi-lightning text-success me-2"></i>Actions rapides
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'modifier_profil_association' %}#logo" class="btn btn-outline-primary w-100">
                                <i class="bi bi-image me-1"></i>Logo
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'modifier_profil_association' %}#reseau" class="btn btn-outline-primary w-100">
                                <i class="bi bi-share me-1"></i>Réseaux
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'modifier_profil_association' %}#documents" class="btn btn-outline-primary w-100">
                                <i class="bi bi-file-earmark me-1"></i>Documents
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'modifier_profil_association' %}#chiffres" class="btn btn-outline-primary w-100">
                                <i class="bi bi-graph-up me-1"></i>Chiffres
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.list-group-item {
    transition: all 0.3s ease;
    border: none;
    border-radius: 8px;
    margin-bottom: 0.25rem;
}

.list-group-item:hover {
    background-color: #f8f9fa;
    transform: translateX(5px);
}

.list-group-item.active {
    background: linear-gradient(135deg, #2563eb, #6366f1);
    border: none;
}

.badge {
    font-size: 0.75rem;
}

.card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.card-header {
    border-radius: 12px 12px 0 0;
    border: none;
}

.alert {
    border-radius: 12px;
    border: none;
}
</style>

<script>
// Scroll doux vers les sections
document.addEventListener('DOMContentLoaded', function() {
    const links = document.querySelectorAll('.list-group-item');
    
    links.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
{% endblock %}