{% extends 'base.html' %}
{% load static humanize %}

{% block title %}Association Dashboard - Solidavenir{% endblock %}

{% block content %}
<div class="container py-5">
    
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h2 mb-0">
                    <i class="fas fa-users text-primary me-2"></i>Association Dashboard
                </h1>
                <div class="btn-group">
                    <a href="{% url 'modifier_profil_association' %}" class="btn btn-primary">
                        <i class="fas fa-edit me-1"></i>Edit Profile
                    </a>
                    <a href="{% url 'creer_projet' %}" class="btn btn-success">
                        <i class="fas fa-plus me-1"></i>New Project
                    </a>
                </div>
            </div>

            <!-- Profile validation badge -->
            <div class="mt-2 ms-1">
                <span class="badge bg-{% if association.valide %}success{% else %}warning{% endif %}">
                    {% if association.valide %}Profile Validated{% else %}Profile Under Review{% endif %}
                </span>
            </div>

            <!-- General message -->
            {% if not association.valide %}
                <p class="text-warning mt-2">
                    Your profile or project is being reviewed by our team. You will be notified as soon as it is validated.
                </p>
            {% endif %}

            <p class="text-muted">Manage your association profile and projects</p>
        </div>
    </div>

    <div class="row">
        <!-- Navigation Sidebar -->
        <div class="col-lg-3">
            <div class="card shadow-sm mb-4">
                <div class="card-body text-center">
                    {% if association.logo %}
                    <img src="{{ association.logo.url }}" 
                         alt="{{ association.nom }}"
                         class="rounded-circle mb-3 border border-4 border-primary"
                         style="width: 100px; height: 100px; object-fit: cover;">
                    {% else %}
                    <div class="bg-light rounded-circle d-flex align-items-center justify-content-center mb-3 mx-auto" style="width: 100px; height: 100px;">
                        <i class="fas fa-users fa-2x text-muted"></i>
                    </div>
                    {% endif %}
                    
                    <h5 class="text-primary">{{ association.nom }}</h5>
                    {% if association.slogan %}
                    <p class="text-muted small">{{ association.slogan }}</p>
                    {% endif %}
                    
                    <div class="d-grid gap-2">
                        <a href="{% url 'modifier_profil_association' %}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-edit me-1"></i> Complete Profile
                        </a>
                    </div>
                </div>
                
                <div class="list-group list-group-flush">
                    <a href="#profile" class="list-group-item list-group-item-action active">
                        <i class="fas fa-user-circle me-2"></i>My Profile
                    </a>
                    <a href="#projects" class="list-group-item list-group-item-action">
                        <i class="fas fa-lightbulb me-2"></i>My Projects
                    </a>
                    <a href="#statistics" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-bar me-2"></i>Statistics
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-lg-9">
            <!-- Profile Section -->
            <div class="card shadow-sm mb-4" id="profile">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-user-circle text-primary me-2"></i>Profile Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>General Information</h6>
                            <p>
                                <strong>Name:</strong> {{ association.nom }}<br>
                                <strong>Slogan:</strong> {{ association.slogan|default:"Not provided" }}<br>
                                <strong>Legal Status:</strong> {{ association.get_statut_juridique_display }}<br>
                                <strong>Main Domain:</strong> {{ association.get_domaine_principal_display }}<br>
                                <strong>Secondary Domains:</strong> {{ association.domaines_secondaires }}<br>
                                <strong>Creation Date:</strong> {{ association.date_creation|date:"m/d/Y" }}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6>Contact</h6>
                            <p>
                                <strong>Email:</strong> {{ association.email_contact|default:"Not provided" }}<br>
                                <strong>Phone:</strong> {{ association.telephone|default:"Not provided" }}<br>
                                <strong>City:</strong> {{ association.ville|default:"Not provided" }}<br>
                                <strong>Country:</strong> {{ association.pays|default:"Not provided" }}<br>
                                <strong>Website:</strong> 
                                {% if association.site_web %}
                                    <a href="{{ association.site_web }}" target="_blank">{{ association.site_web }}</a>
                                {% else %}
                                    Not provided
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    {% if association.causes_defendues %}
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6>Supported Causes</h6>
                            <p class="text-muted">{{ association.causes_defendues }}</p>
                        </div>
                    </div>
                    {% endif %}

                    {% if association.projets_phares %}
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6>Flagship Projects</h6>
                            <p class="text-muted">{{ association.projets_phares }}</p>
                        </div>
                    </div>
                    {% endif %}

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h6>Social Networks</h6>
                            <p>
                                {% if association.facebook %}
                                <a href="{{ association.facebook }}" target="_blank" class="text-decoration-none me-3">
                                    <i class="fab fa-facebook text-primary"></i> Facebook
                                </a><br>
                                {% endif %}
                                {% if association.twitter %}
                                <a href="{{ association.twitter }}" target="_blank" class="text-decoration-none me-3">
                                    <i class="fab fa-twitter text-info"></i> Twitter
                                </a><br>
                                {% endif %}
                                {% if association.instagram %}
                                <a href="{{ association.instagram }}" target="_blank" class="text-decoration-none">
                                    <i class="fab fa-instagram text-danger"></i> Instagram
                                </a>
                                {% endif %}
                                {% if not association.facebook and not association.twitter and not association.instagram %}
                                <span class="text-muted">No social networks provided</span>
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6>Transparency</h6>
                            <p>
                                <strong>Finances:</strong> 
                                {% if association.transparent_finances %}
                                <span class="text-success">✓ Shared</span>
                                {% else %}
                                <span class="text-muted">Not shared</span>
                                {% endif %}<br>
                                <strong>Actions:</strong> 
                                {% if association.transparent_actions %}
                                <span class="text-success">✓ Shared</span>
                                {% else %}
                                <span class="text-muted">Not shared</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects Section -->
            <div class="card shadow-sm mb-4" id="projects">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb text-warning me-2"></i>My Projects
                    </h5>
                </div>
                <div class="card-body">
                    {% if stats.projets_total > 0 %}
                    <div class="row text-center mb-4">
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.projets_total }}</h3>
                                <small class="text-muted">Total Projects</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.projets_actifs }}</h3>
                                <small class="text-muted">Active Projects</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.montant_total|intcomma }} FCFA</h3>
                                <small class="text-muted">Total Raised</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded-3 p-3 bg-light">
                                <h3 class="text-primary">{{ stats.contributeurs_total|default:0 }}</h3>
                                <small class="text-muted">Contributors</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <a href="{% url 'mes_projets' %}" class="btn btn-primary">
                            <i class="fas fa-list me-1"></i> Manage My Projects
                        </a>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-lightbulb text-muted fa-3x"></i>
                        <h5 class="text-muted mt-3">No Projects Created</h5>
                        <p class="text-muted">Start by creating your first funding project.</p>
                        <a href="{% url 'creer_projet' %}" class="btn btn-success">
                            <i class="fas fa-plus me-1"></i> Create a Project
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
                        <!-- GALLERY SECTION - AJOUTÉE ICI -->
<div class="card mb-4">
    <div class="card-body">
        <h3 class="card-title text-primary mb-3">
            <i class="bi bi-images text-info me-2"></i>Photo Gallery
        </h3>
        
        {% if association.images.exists %}
        <div class="row">
            {% for image in quatre_images %}
            <div class="col-md-3 mb-3">
                <img src="{{ image.image.url }}" 
                     class="img-thumbnail gallery-image" 
                     alt="{{ image.legende|default:'' }}" 
                     style="height: 150px; object-fit: cover;"
                     title="{{ image.legende|default:'' }}">
            </div>
            {% endfor %}
        </div>
        
        <div class="mt-3">
            <a href="{% url 'association_images_list' association.slug %}" class="btn btn-outline-primary">
                View all photos ({{ association.images.count }})
            </a>
            
            {% if user.is_authenticated and est_membre %}
            <a href="{% url 'upload_association_image' association.slug %}" class="btn btn-primary">
                <i class="bi bi-plus-circle me-1"></i>Add a photo
            </a>
            {% endif %}
        </div>
        
        {% else %}
        <div class="text-center py-4">
            <i class="bi bi-images text-muted" style="font-size: 3rem;"></i>
            <p class="text-muted mt-2">No photos available yet.</p>
            
            {% if user.is_authenticated and est_membre %}
            <a href="{% url 'upload_association_image' association.slug %}" class="btn btn-primary">
                <i class="bi bi-plus-circle me-1"></i>Add the first photo
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

            <!-- Quick Actions Section -->
            <div class="card shadow-sm mb-4" id="statistics">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt text-success me-2"></i>Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'modifier_profil_association' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-image me-1"></i>Logo & Banner
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'modifier_profil_association' %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-share-alt me-1"></i>Social Networks
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'creer_projet' %}" class="btn btn-outline-success w-100">
                                <i class="fas fa-plus me-1"></i>New Project
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.list-group-item {
    transition: all 0.3s ease;
    border: none;
    border-radius: 8px;
    margin-bottom: 0.25rem;
}

.list-group-item:hover {
    background-color: #f8f9fa;
    transform: translateX(5px);
}

.list-group-item.active {
    background: linear-gradient(135deg, #2563eb, #6366f1);
    border: none;
}

.card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.card-header {
    border-radius: 12px 12px 0 0;
    border: none;
}
</style>

<script>
// Smooth scroll to sections
document.addEventListener('DOMContentLoaded', function() {
    const links = document.querySelectorAll('.list-group-item');
    
    links.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
{% endblock %}